<!DOCTYPE html>
<html>
<head>
    <title>QuickSync</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; }
        button { 
            padding: 12px 20px; 
            font-size: 1em; 
            cursor: pointer; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            transition: background-color 0.3s ease;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #status { margin-top: 20px; font-weight: bold; padding: 10px; border-radius: 5px; }
        .status-success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; }
        .status-error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .status-info { color: #0c5460; background-color: #d1ecf1; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>QuickSync</h1>
        <p>Sync contacts from MockAPI to Mailchimp.</p>
        <button id="syncButton">Sync Contacts</button>
        <div id="status"></div>
    </div>

    <script>
        const syncButton = document.getElementById('syncButton');
        const statusDiv = document.getElementById('status');

        syncButton.addEventListener('click', async () => {
            statusDiv.textContent = 'Syncing...';
            statusDiv.className = 'status-info'; // Reset class
            syncButton.disabled = true;
            try {
                // Use relative path for the API endpoint
                const response = await fetch('/contacts/sync'); // This path needs to be correctly routed by Netlify
                statusDiv.textContent = ''; // Clear status before showing result
                statusDiv.className = ''; // Clear class

                const result = await response.json(); // Try parsing JSON regardless of status

                if (!response.ok) {
                    let errorMsg = `HTTP error ${response.status}`; 
                    if(result && result.detail) { // FastAPI often returns errors in 'detail'
                       errorMsg = typeof result.detail === 'string' ? result.detail : JSON.stringify(result.detail);
                    } else if (result) {
                       errorMsg = JSON.stringify(result);
                    }
                    throw new Error(errorMsg);
                }
                
                // *** Still need to fix this line based on the actual SyncResponse model ***
                // For now, let's display the raw result
                statusDiv.textContent = `Sync successful! Response: ${JSON.stringify(result)}`;
                // Example if SyncResponse had { syncedContacts: number }:
                // statusDiv.textContent = `Sync successful! Synced: ${result.syncedContacts}`; 
                statusDiv.classList.add('status-success');
            } catch (error) {
                console.error('Sync failed:', error);
                statusDiv.textContent = `Sync failed: ${error.message}`;
                statusDiv.classList.add('status-error');
            } finally {
                syncButton.disabled = false;
            }
        });
    </script>
</body>
</html> 